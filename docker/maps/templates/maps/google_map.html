<!DOCTYPE html>
<html>
<head>
    <title>Leaflet Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        #container {
            display: flex;
        }
        #map {
            height: 600px;
            width: 70%;
        }
        #event-list {
            width: 30%;
            padding: 10px;
            overflow-y: auto;
            height: 600px;
            border-left: 1px solid #ccc;
        }
        .event-item {
            margin-bottom: 10px;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <h1>Leaflet Map with Event List</h1>
    <div id="container">
        <div id="map"></div>
        <div id="event-list">
            <form method="get">
                {{ form.as_p }}
                <button type="submit">Filter</button>
            </form>
            <hr>
            {% for event in events %}
                <div class="event-item" data-location="{{ event.location }}">
                    <h3>{{ event.name }}</h3>
                    <p>Date: {{ event.date }}</p>
                    <p>Category: {{ event.category }}</p>
                    <p>Location: {{ event.location }}</p>
                    <p>City: {{ event.city }}</p>
                    <a href="{% url 'event_details' event.name|urlencode event.location|urlencode event.date|date:'Y-m-d'|urlencode event.category|urlencode event.city|urlencode %}">View Details</a>
                </div>
            {% endfor %}
        </div>
    </div>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([37.5665, 126.9780], 13); // 서울 좌표

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // 마커 추가
        L.marker([37.5665, 126.9780]).addTo(map)
            .bindPopup('서울')
            .openPopup();

        function openEventPage(name, location, date, category, city) {
            var newPageUrl = 'event_details.html?name=' + encodeURIComponent(name) +
                             '&location=' + encodeURIComponent(location) +
                             '&date=' + encodeURIComponent(date) +
                             '&category=' + encodeURIComponent(category) +
                             '&city=' + encodeURIComponent(city);
            window.location.href = newPageUrl;
        }
    </script>
</body>
</html>

